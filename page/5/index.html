
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>LittleQ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="LittleQ">
    

    
    <meta name="description" content="数据开发工程师的成长历程">
<meta property="og:type" content="website">
<meta property="og:title" content="LittleQ">
<meta property="og:url" content="http://sjq597.github.io/page/5/index.html">
<meta property="og:site_name" content="LittleQ">
<meta property="og:description" content="数据开发工程师的成长历程">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LittleQ">
<meta name="twitter:description" content="数据开发工程师的成长历程">

    
    <link rel="alternative" href="/atom.xml" title="LittleQ" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="LittleQ" title="LittleQ"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="LittleQ">LittleQ</a></h1>
				<h2 class="blog-motto">爱好：写代码</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:sjq597.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/24/Flask-学习笔记01/" title="Flask 学习笔记01 " itemprop="url">Flask 学习笔记01 </a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-24T10:56:39.000Z" itemprop="datePublished"> 发表于 2016-04-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>由于平时经常使用Python,所以想使用Python的微框架开发一些简单的工具来提升工作效率，特此记录一下学习Flask的笔记。</p>
<h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><p>本机系统: Ubuntu 14.04 64bits<br>所有的学习第一步就是配置开发环境，还好Ubuntu自带了Python,这里采用的虚拟Python配置，<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-<span class="built_in">get</span> install <span class="keyword">python</span>-virtualenv</div></pre></td></tr></table></figure></p>
<p>或者使用pip安装:<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span><span class="variable">$ </span>sudo pip install virtualenv</div></pre></td></tr></table></figure></p>
<p>如果你是Windows用户，并且你已经安装了<code>pip</code>工具，则去掉<code>sudo</code>在cmd命令下也可以安装<br>然后创建一个包含<code>venv</code>的文件夹的项目文件夹，项目就建在这里面<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo mkdir flask_project</div><div class="line"><span class="variable">$ </span>cd flask_project</div><div class="line"><span class="variable">$ </span>sudo virtualenv venv</div></pre></td></tr></table></figure></p>
<p>现在每次要使用项目，就可以在<code>flask_project</code>文件夹中运行下面的命令<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . venv/bin/<span class="built_in">activate</span></div></pre></td></tr></table></figure></p>
<p>对应的Windows启动命令为<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ . venv/Scripts/<span class="built_in">activate</span></div></pre></td></tr></table></figure></p>
<p>你现在进入你的virtualenv(注意查看你的shell提示符已经改变了)。每次需要安装包的时候就先激活虚拟环境，下面安装<code>flask</code><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip <span class="keyword">install</span> flask</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong>这里有个地方需要个别强调一下，安装包不能使用sudo权限来安装，如果不带<code>sudo</code>安装提示权限不够，请把<code>flask_project</code>文件夹的权限设置为当前用户,例如，当前用户为<code>zhangsan</code>,在<code>flask_project</code>的父目录执行:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">sudo</span> <span class="selector-tag">chown</span> <span class="selector-tag">zhangsan</span><span class="selector-pseudo">:zhangsan</span> <span class="selector-tag">-R</span> <span class="selector-tag">flask_project</span></div></pre></td></tr></table></figure></p>
<p>相应的退出使用:<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>deactivate</div></pre></td></tr></table></figure></p>
<h3 id="一个最简单的应用"><a href="#一个最简单的应用" class="headerlink" title="一个最简单的应用"></a>一个最简单的应用</h3><p>在<code>flask_project</code>文件夹中创建一个文件<code>hello.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run()</div></pre></td></tr></table></figure></p>
<p>在命令行或者终端里运行:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">python</span> hello.<span class="keyword">py</span></div></pre></td></tr></table></figure></p>
<p>然后在浏览器打开<code>http://127.0.0.1:5000/</code>就可以看到一个最简单的hello world页面了。大概解释一下：</p>
<ol>
<li>首先我们导入了<strong>Flask</strong>类。这个类的实例将会成为我们的<strong>WSGI</strong>应用,即后面的<strong>app</strong>。</li>
<li>接着我们创建了这个类的实例。第一个参数是应用模块或者包的名称。如果你使用一个 单一模块（就像本例），那么应当使用<code>__name__</code>,因为名称会根据这个模块是按 应用方式使用还是作为一个模块导入而发生变化（可能是<code>__main__</code>，也可能是 实际导入的名称）。这个参数是必需的，这样<strong>Flask</strong>就可以知道在哪里找到模板和 静态文件等东西。不明白也没关系，先这么写，后面慢慢会深入研究。</li>
<li>然后我们使用<code>route()</code>装饰器来告诉<strong>Flask</strong>触发函数的<strong>URL</strong>。函数名称可用于生成相关联的<strong>URL</strong>，并返回需要在用户浏览器中显示的信息。这个和Java里的<strong>Controller</strong>非常的像，用过Spring的同学对此应该很熟悉。</li>
<li>最后，使用<code>run()</code>函数来运行本地服务器和我们的应用。<code>if __name__ == &#39;__main__&#39;:</code> 确保服务器只会在使用Python解释器运行代码的情况下运行，而不会在作为模块导入时运行。</li>
</ol>
<p>本机访问没问题，但是局域网的其他机器如果也想访问，则需要这样启动:<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.run(host='<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>')</div></pre></td></tr></table></figure></p>
<p>这行代码告诉你的操作系统监听一个公开的IP 。</p>
<h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h3><p>开发程序不可能这么简单，需要不断的调试，所以<strong>Flask</strong>也为我们想好了，专门有个调试模式，这样不用重启服务器，代码有变动，会自动重启，并且出错提示信息也很强大，打开调试器的有两种方式：</p>
<ol>
<li><p>通过设置实例的属性</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">app</span>.debug = True</div><div class="line"><span class="keyword">app</span>.<span class="keyword">run</span>()</div></pre></td></tr></table></figure>
</li>
<li><p>启动传参设置</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.<span class="built_in">run</span>(debug=<span class="literal">True</span>)</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>注意:</strong>调试器很强大，可以执行任意代码，所以千万不要在项目上线之后打开调试模式。</p>
<h3 id="路由route"><a href="#路由route" class="headerlink" title="路由route()"></a>路由route()</h3><p>路由装饰器用于将一个函数和一个<strong>URL</strong>绑定，例如:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@app</span>.route(<span class="string">'/'</span>)</div><div class="line">def index():</div><div class="line">    return <span class="string">'Index Page'</span></div><div class="line"></div><div class="line"><span class="variable">@app</span>.route(<span class="string">'/hello'</span>)</div><div class="line">def hello():</div><div class="line">    return <span class="string">'Hello World'</span></div></pre></td></tr></table></figure></p>
<p>这只是最简单，最基础的，实际开发中不可能都是这么简单的URL,大多数情况下URL里面有一部分是动态变化的，例如好多URL里面会带ID,表示网页的一个标号。</p>
<h4 id="变量规则"><a href="#变量规则" class="headerlink" title="变量规则"></a>变量规则</h4><p><variable_name>里面可以添加变量，<converter:variable_name>可以为变量加一个转换器,目前只支持<code>int,float,path</code>最后一个为路径，接受<code>/</code>，例如：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@app.route(<span class="string">'/user/&lt;username&gt;'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_user_profile</span><span class="params">(username)</span></span>:</div><div class="line">    <span class="comment"># 通过获取URL的user_name作为函数的传入参数</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'User %s'</span> % username</div><div class="line"></div><div class="line">@app.route(<span class="string">'/post/&lt;int:post_id&gt;'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_post</span><span class="params">(post_id)</span></span>:</div><div class="line">    <span class="comment"># 传入post_id，并且必须是一个整数</span></div><div class="line">    <span class="keyword">return</span> <span class="string">'Post %d'</span> % post_id</div></pre></td></tr></table></figure></converter:variable_name></variable_name></p>
<h4 id="唯一URL-重定向问题"><a href="#唯一URL-重定向问题" class="headerlink" title="唯一URL/重定向问题"></a>唯一URL/重定向问题</h4><p>看下面一个例子:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@app</span>.route(<span class="string">'/projects/'</span>)</div><div class="line">def projects():</div><div class="line">    return <span class="string">'The project page'</span></div><div class="line"></div><div class="line"><span class="variable">@app</span>.route(<span class="string">'/about'</span>)</div><div class="line">def about():</div><div class="line">    return <span class="string">'The about page'</span></div></pre></td></tr></table></figure></p>
<p>注意一个尾部有<strong>斜杠</strong>，一个没有。看上去带<strong>斜杠</strong>的URL很像一个文件夹，当我们访问一个没有带<strong>斜杠</strong>的URL的时候，为自动加一个<strong>斜杠</strong>。但是反过来，如果访问第二个URL你在尾部带了一个<strong>斜杠</strong>，则会报错。可能你有些疑惑，为啥要这么做，答案也很简单：这样在访问一个不带<strong>斜杠</strong>的URL时，不管真正的URL是否带<strong>斜杠</strong>我们都可以继续访问URL,并且URL是唯一的。</p>
<h4 id="URL构建"><a href="#URL构建" class="headerlink" title="URL构建"></a>URL构建</h4><p>设想一下，你想先设定好页面的访问URL,你需要测试你写的函数能不能被你指定的URL访问到，直接构建这些URL就可以了。<code>url_for</code>它把函数名称作为第一个参数，其余参数对应URL中的变量。未知变量将添加到URL中作为查询参数。 例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, url_for</div><div class="line">app = Flask(__name__)</div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span> <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/login')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span> <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/user/&lt;username&gt;')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile</span><span class="params">(username)</span>:</span> <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="keyword">with</span> app.test_request_context():</div><div class="line">	<span class="keyword">print</span> url_for(<span class="string">'index'</span>)</div><div class="line">	<span class="keyword">print</span> url_for(<span class="string">'login'</span>)</div><div class="line">	<span class="keyword">print</span> url_for(<span class="string">'login'</span>, next=<span class="string">'/'</span>)</div><div class="line">	<span class="keyword">print</span> url_for(<span class="string">'profile'</span>, username=<span class="string">'John Doe'</span>)</div></pre></td></tr></table></figure></p>
<p>运行程序会输出以下内容:<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/</div><div class="line"><span class="regexp">/login</span></div><div class="line">/login?<span class="keyword">next</span>=<span class="regexp">/</span></div><div class="line">/user<span class="regexp">/John%20Doe</span></div></pre></td></tr></table></figure></p>
<p>这里用到了一个方法<code>test_request_context()</code>,这个会告诉<code>Flask</code>我们正在处理一个请求，虽然我们并没有真正的去请一个URL.</p>
<h4 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h4><p>访问一个URL有好几个方法，常见的就是get，post方法,缺省情况下一个路由只回应GET请求，也可以像下面这样手动指定：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@app.route(<span class="string">'/login'</span>, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span></span>:</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        do_the_login()</div><div class="line">    <span class="symbol">else:</span></div><div class="line">        show_the_login_form()</div></pre></td></tr></table></figure></p>
<h4 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h4><p>一般就是指css,js文件，如果工程里面要用到这些静态的库，可以在应用的根目录下新建<code>static</code>文件夹,设用选定的<code>static</code>端点就可以生成对应的URL：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">url_for</span><span class="params">(<span class="string">'static'</span>, filename=<span class="string">'style.css'</span>)</span></span></div></pre></td></tr></table></figure></p>
<p>因此该文件对应的在文件系统中的路径应该是<code>static/style.css</code></p>
<h4 id="渲染模板"><a href="#渲染模板" class="headerlink" title="渲染模板"></a>渲染模板</h4><p>这是个很强大的功能，基本上目前的框架都得支持这个，毕竟原生的写HTML很慢，还要考虑各种转义，乱码等，Flask内置Jinja2模板引擎。使用<code>render_template()</code>来渲染模板,只需要把模板的名字和对应的一些参数传进去就行了，例如:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">from flask import render_template</div><div class="line"></div><div class="line">@app.route(<span class="string">'/hello/'</span>)</div><div class="line">@app.route(<span class="string">'/hello/&lt;name&gt;'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name=None)</span></span>:</div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>, name=name)</div></pre></td></tr></table></figure></p>
<p>Flask默认会在<code>templates</code>文件夹内寻找模板，如果你的应用是一个模块,则<code>templates</code>文件夹应该和应用在一个目录下,即:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/application<span class="selector-class">.py</span></div><div class="line">/templates</div><div class="line">    /hello.html</div></pre></td></tr></table></figure></p>
<p>如果你的应用是一个包,则应该在包里面:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/application</div><div class="line">    /__init__<span class="selector-class">.py</span></div><div class="line">    /templates</div><div class="line">        /hello.html</div></pre></td></tr></table></figure></p>
<p>这个就类似预JSP一类的东西，你也可以在模板内部访问**request, session, get_flashed_messages()<code>等，不过比JSP更加强大,因为模板可以实现继承，这样就能保持很多特定的元素重用，保持一致。
默认特殊的一些变量会被转义，例如HTML,如果信任某个变量，也可以使用</code>Markup`类来把它标记为安全的,具体的等学到了再详细研究。</p>
<h3 id="操作请求数据"><a href="#操作请求数据" class="headerlink" title="操作请求数据"></a>操作请求数据</h3><p>一个Web应用其实就是服务器相应客户端发来的消息，Flask中由全局对象<code>request</code>来提供请求信息，如果你熟悉Python你就会知道，全局的对象大家都可以访问，其实也并不是通常意义上的全局变量，这个request只是特定环境下的本地对象的一个代理。</p>
<h4 id="请求对象"><a href="#请求对象" class="headerlink" title="请求对象"></a>请求对象</h4><p>首先必须从flask模块导入请求对象<code>from flask import request</code>,使用<code>method</code>属性可以操作当前请求的具体方法，<code>form</code>可以处理表单数据,例如:<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@app.route(<span class="string">'/login'</span>, methods=[<span class="string">'POST'</span>, <span class="string">'GET'</span>])</div><div class="line">def login():</div><div class="line">    <span class="keyword">error</span> = None</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        <span class="keyword">if</span> valid_login(request.form[<span class="string">'username'</span>],</div><div class="line">                       request.form[<span class="string">'password'</span>]):</div><div class="line">            <span class="keyword">return</span> log_the_user_in(request.form[<span class="string">'username'</span>])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">error</span> = <span class="string">'Invalid username/password'</span></div><div class="line">    # 如果请求访求是 GET 或验证未通过就会执行下面的代码</div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'login.html'</span>, <span class="keyword">error</span>=<span class="keyword">error</span>)</div></pre></td></tr></table></figure></p>
<p>如果form属性中不存在这个键值，会像普通集合那样抛出一个<code>KeyError</code>的异常。如果不捕获的话，就会显示一个<code>HTTP 400 Bad Request</code>错误页面，虽然你可以不用处理这个异常，但是显然不是很友好，所以推荐捕获异常，然会一个预定义好的错误页面.<br>如果要处理URL中的参数，可以使用<code>request.args.get(&#39;key&#39;, &#39;&#39;)</code>来获取.</p>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>使用Flask实现文件上传很简单，需要在HTML表单中设置<code>enctype=&quot;multipart/form-data</code>属性即可，上传的文件被存储在内存或者文件系统临时位置，通过请求对象files属性可以访问上传文件,看下面的例子：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from flask import request</div><div class="line"></div><div class="line">@app.route(<span class="string">'/upload'</span>, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span></span>:</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        f = request.files[<span class="string">'the_file'</span>]</div><div class="line">        f.save(<span class="string">'/var/www/uploads/uploaded_file.txt'</span>)</div></pre></td></tr></table></figure></p>
<p>要想知道文件上传之前在客户端系统的名字，可以使用<code>filename</code>属性，但是这个可以伪造，所以建议通过<code>Werkzeug</code>提供的<code>secure_filename()</code>函数：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</div><div class="line"><span class="keyword">from</span> werkzeug <span class="keyword">import</span> secure_filename</div><div class="line"></div><div class="line">@app.route(<span class="string">'/upload'</span>, methods=[<span class="string">'GET'</span>, <span class="string">'POST'</span>])</div><div class="line">def upload_file():</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        f = request.files[<span class="string">'the_file'</span>]</div><div class="line">        f.save(<span class="string">'/var/www/uploads/'</span> + secure_filename(f.filename))</div></pre></td></tr></table></figure></p>
<h4 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h4><p>对于Web应用来说，这个必不可少，要访问cookeis,可以使用<code>cookies</code>属性。通过请求对象的<code>set_cookies</code>方法设置<code>cookies</code>，请求对象的<code>cookies</code>包含了客户端的所有cookies字典，所以这很不安全，能使用会话就不要直接使用cookies.</p>
<ul>
<li><p>读cookies:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    username = request.cookies.get(<span class="string">'username'</span>)</div><div class="line">    <span class="comment"># 使用 cookies.get(key) 来代替 cookies[key] ，</span></div><div class="line">    <span class="comment"># 以避免当 cookie 不存在时引发 KeyError 。</span></div></pre></td></tr></table></figure>
</li>
<li><p>存储cookies:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> make_response</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    resp = make_response(render_template(...))</div><div class="line">    resp.set_cookie(<span class="string">'username'</span>, <span class="string">'the username'</span>)</div><div class="line">    <span class="keyword">return</span> resp</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注意:</strong>cookies设置在响应对象上，通常只是视图函数返回字符串，Flask会把它们转化为响应对象,显示的转化可以使用<code>make_response()</code>函数,然后再修改对应的值.</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p><code>redirect()</code>函数可以重定向,<code>abort()</code>可以更早的退出请求，返回错误码:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">from flask import abort, redirect, url_for</div><div class="line"></div><div class="line">@app.route(<span class="string">'/'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span></span>:</div><div class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'login'</span>))</div><div class="line"></div><div class="line">@app.route(<span class="string">'/login'</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span></span>:</div><div class="line">    abort(<span class="number">401</span>)</div><div class="line">    this_is_never_executed()</div></pre></td></tr></table></figure></p>
<p><code>401</code>表示一个无法访问的页面,缺省情况下每种错误代码都会对应显示一个黑白的出错页面。使用<code>errorhandler()</code>装饰器可以定制出错页面:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</div><div class="line"></div><div class="line"><span class="meta">@app.errorhandler(404)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span><span class="params">(error)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'page_not_found.html'</span>), <span class="number">404</span></div></pre></td></tr></table></figure></p>
<h4 id="关于响应"><a href="#关于响应" class="headerlink" title="关于响应"></a>关于响应</h4><p>视图函数的返回值会自动转化为一个响应对象。如果你返回一个字符串，那么就会被转换为一个响应对象，其中包含这个字符串以及一些其他的必要信息，如果想在视图内部掌控响应对象的结果，可以使用一个<code>make_response()</code>函数进行强制转换，例如原始视图:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@app.errorhandler(<span class="number">404</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_found</span><span class="params">(error)</span></span>:</div><div class="line">    <span class="keyword">return</span> render_template(<span class="string">'error.html'</span>), <span class="number">404</span></div></pre></td></tr></table></figure></p>
<p>可以手动包装，修改某些特定的内容，例如头部信息：<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@app.errorhandler(<span class="number">404</span>)</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_found</span><span class="params">(error)</span></span>:</div><div class="line">    resp = make_response(render_template(<span class="string">'error.html'</span>), <span class="number">404</span>)</div><div class="line">    resp.headers[<span class="string">'X-Something'</span>] = <span class="string">'A value'</span></div><div class="line">    <span class="keyword">return</span> resp</div></pre></td></tr></table></figure></p>
<h4 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h4><p>除了请求对象和响应对象之外，还有个<code>session</code>这个对象，这个主要是用来在不同请求之间存储信息的。你可以简单理解为用密钥签名加密的cookie,cookie都可以查看，但是如果没有密钥就无法修改。所以使用会话之前必须设置一个密钥：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, redirect, url_for, escape, request</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</div><div class="line">        <span class="keyword">return</span> <span class="string">'Logged in as %s'</span> % escape(session[<span class="string">'username'</span>])</div><div class="line">    <span class="keyword">return</span> <span class="string">'You are not logged in'</span></div><div class="line"></div><div class="line"><span class="meta">@app.route('/login', methods=['GET', 'POST'])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        session[<span class="string">'username'</span>] = request.form[<span class="string">'username'</span>]</div><div class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</div><div class="line">    <span class="keyword">return</span> <span class="string">'''</span></div><div class="line">        &lt;form action="" method="post"&gt;</div><div class="line">            &lt;p&gt;&lt;input type=text name=username&gt;</div><div class="line">            &lt;p&gt;&lt;input type=submit value=Login&gt;</div><div class="line">        &lt;/form&gt;</div><div class="line">    '''</div><div class="line"></div><div class="line"><span class="meta">@app.route('/logout')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># 如果会话中有用户名就删除它。</span></div><div class="line">    session.pop(<span class="string">'username'</span>, <span class="keyword">None</span>)</div><div class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</div><div class="line"></div><div class="line"><span class="comment"># 设置密钥，复杂一点：</span></div><div class="line">app.secret_key = <span class="string">'A0Zr98j/3yX R~XHH!jmN]LWX/,?RT'</span></div></pre></td></tr></table></figure></p>
<p><code>escape()</code>可以用来转义，如果你使用模板就简单的多，不用管这些。<br>生成密钥要保证做够随机,例如根据操作系统来生成一个密钥:<br><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="built_in">os</span></div><div class="line"><span class="built_in">os</span>.urandom(<span class="number">24</span>)</div></pre></td></tr></table></figure></p>
<p>基于<code>cookies</code>的会话，Flask其实是把会话对象里面的值都放在了cookies里面，如果你访问的会话里没有对应的属性。</p>
<h4 id="消息闪现"><a href="#消息闪现" class="headerlink" title="消息闪现"></a>消息闪现</h4><p>啥意思？简单来说就是在你请求结束的时候记录一个消息，然后你下次再请求的时候可以使用，然后用完就销毁了，所以叫闪现。<code>flash()</code>用于闪现一个消息，<code>get_flashed_messages()</code>来操作一个消息，具体的不介绍了，这个用的不是很多，用到再研究。</p>
<h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><p>一个Web应用当然少不了日志，万一崩了，直接看日志定位问题，使用也很简单:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">app<span class="selector-class">.logger</span><span class="selector-class">.debug</span>(<span class="string">'A value for debugging'</span>)</div><div class="line">app<span class="selector-class">.logger</span><span class="selector-class">.warning</span>(<span class="string">'A warning occurred (%d apples)'</span>, <span class="number">42</span>)</div><div class="line">app<span class="selector-class">.logger</span><span class="selector-class">.error</span>(<span class="string">'An error occurred'</span>)</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Flask/">Flask</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a><a href="/tags/Web/">Web</a><a href="/tags/Flask/">Flask</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/24/Python-写csv文件Excel打开乱码解决方案/" title="Python 写csv文件Excel打开乱码解决方案" itemprop="url">Python 写csv文件Excel打开乱码解决方案</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-24T10:37:32.000Z" itemprop="datePublished"> 发表于 2016-04-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h3><p>最近为公司开发了一套邮件日报程序，邮件一般就是表格，图片，然后就是附件。附件一般都是默认写到txt文件里，但是PM希望邮件里的附件能直接用Excel这种软件打开，最开始想保存为Excel，但是一想Excel的文件体积会多出好多倍，csv文件默认也是使用Excel打开的，但是根本还是文本文件，体积小，保存也方便，于是最终决定使用csv模块来保存文件。</p>
<h3 id="Python写csv文件"><a href="#Python写csv文件" class="headerlink" title="Python写csv文件"></a>Python写csv文件</h3><p>Python提供了内置模块读写csv文件，这里我只用到了写，读这里就不做介绍了，也不难,主要是解决乱码问题。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">save2csv</span><span class="params">(file_name=None, header=None, data=None)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    保存成CSV格式文件,方便Excel直接打开</div><div class="line">    :param file_name: 保存的文件名</div><div class="line">    :param header: 表头,每一列的名字</div><div class="line">    :param data: 具体填充数据</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> file_name <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> isinstance(file_name, basestring) <span class="keyword">is</span> <span class="keyword">False</span>:</div><div class="line">        <span class="keyword">raise</span> Exception(<span class="string">'保存CSV文件名不能为空,并且必须为字符串类型'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> file_name.endswith(<span class="string">'.csv'</span>) <span class="keyword">is</span> <span class="keyword">False</span>:</div><div class="line">        file_name += <span class="string">'.csv'</span></div><div class="line"></div><div class="line">    file_obj = open(file_name, <span class="string">'wb'</span>)</div><div class="line">    file_obj.write(codecs.BOM_UTF8)     <span class="comment"># 防止乱码</span></div><div class="line">    writer = csv.writer(file_obj)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> isinstance(data, (tuple, list)) <span class="keyword">is</span> <span class="keyword">False</span>:</div><div class="line">        <span class="keyword">raise</span> Exception(<span class="string">'保存CSV文件失败,数据为空或者不是数据类型'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> header <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> isinstance(header, (tuple, list)) <span class="keyword">is</span> <span class="keyword">True</span>:</div><div class="line">        writer.writerow(header)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> data:</div><div class="line">        writer.writerow(row)</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong>有三句话就是为了防止乱码的<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">file_obj = <span class="keyword">open</span>(file_name, 'wb')</div><div class="line">file_obj.write(codecs.BOM_UTF8)     <span class="meta"># 防止乱码</span></div><div class="line"><span class="built_in">writer</span> = csv.<span class="built_in">writer</span>(file_obj)</div></pre></td></tr></table></figure></p>
<p>在文件头部写入<code>codecs.BOM_UTF8</code>就能防止乱码了,文件都是utf-8编码格式的。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python笔记/">Python笔记</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/24/Hive-group-by-distinct性能调优/" title="Hive group by distinct性能调优" itemprop="url">Hive group by distinct性能调优</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-24T09:51:15.000Z" itemprop="datePublished"> 发表于 2016-04-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="Hive去重统计"><a href="#Hive去重统计" class="headerlink" title="Hive去重统计"></a>Hive去重统计</h3><p>相信使用Hive的人平时会经常用到去重统计之类的吧，但是好像平时很少关注这个去重的性能问题，但是当一个表的数据量非常大的时候，会发现一个简单的<code>count(distinct order_no)</code>这种语句跑的特别慢，和直接运行<code>count(order_no)</code>的时间差了很多，于是研究了一下。<br><strong>先说结论:</strong>能使用<code>group by</code>代替<code>distinc</code>就不要使用<code>distinct</code>，例子：</p>
<h3 id="实际论证"><a href="#实际论证" class="headerlink" title="实际论证"></a>实际论证</h3><p>order_snap为订单的快照表 总记录条数763191489，即将近8亿条记录,总大小:108.877GB,存储的是公司所有的订单信息，表的字段大概有20个,其中订单号是没有重复的,所以在统计总共有多少订单号的时候去重不去重结果都一样，我们来看看:<br>统计所有的订单有多少条条数，一个<code>count</code>函数就可以搞定的sql性能如何。</p>
<ul>
<li>DISTINCT</li>
</ul>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">select count(distinct order_no) from order_snap;</div><div class="line">Stage-Stage-1: Map:<span class="number"> 396 </span> Reduce:<span class="number"> 1 </span>  Cumulative CPU: 7915.67 sec   HDFS Read:<span class="number"> 119072894175 </span>HDFS Write:<span class="number"> 10 </span>SUCCESS</div><div class="line">Total MapReduce CPU Time Spent:<span class="number"> 0 </span>days<span class="number"> 2 </span>hours<span class="number"> 11 </span>minutes<span class="number"> 55 </span>seconds<span class="number"> 670 </span>msec</div><div class="line"><span class="symbol">OK</span></div><div class="line">_c0</div><div class="line">763191489</div><div class="line">Time taken: 1818.864 seconds, Fetched:<span class="number"> 1 </span>row(s)</div></pre></td></tr></table></figure>
<ul>
<li>GROUP BY</li>
</ul>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">select count(t.order_no) from (select order_no from order_snap group by order_no) t;</div><div class="line">Stage-Stage-1: Map:<span class="number"> 396 </span> Reduce:<span class="number"> 457 </span>  Cumulative CPU: 10056.7 sec   HDFS Read:<span class="number"> 119074266583 </span>HDFS Write:<span class="number"> 53469 </span>SUCCESS</div><div class="line">Stage-Stage-2: Map:<span class="number"> 177 </span> Reduce:<span class="number"> 1 </span>  Cumulative CPU: 280.22 sec   HDFS Read:<span class="number"> 472596 </span>HDFS Write:<span class="number"> 10 </span>SUCCESS</div><div class="line">Total MapReduce CPU Time Spent:<span class="number"> 0 </span>days<span class="number"> 2 </span>hours<span class="number"> 52 </span>minutes<span class="number"> 16 </span>seconds<span class="number"> 920 </span>msec</div><div class="line"><span class="symbol">OK</span></div><div class="line">_c0</div><div class="line">763191489</div><div class="line">Time taken: 244.192 seconds, Fetched:<span class="number"> 1 </span>row(s)</div></pre></td></tr></table></figure>
<p><strong>结论:</strong>第二种写法的性能是第一种的<code>7.448499541</code>倍<br>注意到为什么会有这个差异，Hadoop其实就是处理大数据的，Hive并不怕数据有多大，怕的就是数据倾斜,我们看看两者的输出信息:<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># distinct</span></div><div class="line">Stage-Stage-1: Map:<span class="number"> 396 </span> Reduce:<span class="number"> 1 </span>  Cumulative CPU: 7915.67 sec   HDFS Read:<span class="number"> 119072894175 </span>HDFS Write:<span class="number"> 10 </span>SUCCESS</div><div class="line"><span class="comment"># group by</span></div><div class="line">Stage-Stage-1: Map:<span class="number"> 396 </span> Reduce:<span class="number"> 457 </span>  Cumulative CPU: 10056.7 sec   HDFS Read:<span class="number"> 119074266583 </span>HDFS Write:<span class="number"> 53469 </span>SUCCESS</div></pre></td></tr></table></figure></p>
<p>发现猫腻了没有，使用distinct会将所有的order_no都shuffle到一个reducer里面，这就是我们所说的数据倾斜，都倾斜到一个reducer这样性能能不低么？再看第二个，直接按订单号分组，起了457个<code>reducer</code>，将数据分布到多台机器上执行，时间当然快了.<br>由于没有手动指定Reduce的个数，Hive会根据数据的大小动态的指定Reduce大小，你也可以手动指定<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hive&gt; set mapred<span class="selector-class">.reduce</span><span class="selector-class">.tasks</span>=<span class="number">100</span>；</div></pre></td></tr></table></figure></p>
<p>类似这样,所以如果数据量特别大的情况下，尽量不要使用<code>distinct</code>吧。<br>但是如果你想在一条语句里看总记录条数以及去重之后的记录条数，那没有办法过滤，所以你有两个选择，要么使用两个sql语句分别跑，然后union all或者就使用普通的distinct。具体来说得看具体情况，直接使用distinct可读性好，数据量如果不大的话推荐使用，如果数据太大了，性能受到影响了，再考虑优化。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Hive笔记/">Hive笔记</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Hive/">Hive</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/24/SSH-免密码登陆/" title="SSH 免密码登陆" itemprop="url">SSH 免密码登陆</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-24T03:07:12.000Z" itemprop="datePublished"> 发表于 2016-04-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>开发工作中，经常需要使用ssh来登录服务器，密码一般都是机器生成的，特别难记，关键是机器多了这样也麻烦，所以配置一下ssh面密码登录，节省时间。</p>
<h3 id="系统说明"><a href="#系统说明" class="headerlink" title="系统说明"></a>系统说明</h3><p>本地机器：Ubuntu<br>服务器：CentOS</p>
<h3 id="大概流程"><a href="#大概流程" class="headerlink" title="大概流程"></a>大概流程</h3><p>需要服务器和本机都做一定的配置才能免密码登陆</p>
<h4 id="本地机器配置"><a href="#本地机器配置" class="headerlink" title="本地机器配置"></a>本地机器配置</h4><ol>
<li>通过<code>ssh-keygen</code>产生RSA公私密钥对</li>
</ol>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh-keygen`</div></pre></td></tr></table></figure>
<p>然后一路回车，不要输入任何密码和字符，最后在<code>~/.ssh/</code>文件夹中会生成两个文件<code>id_rsa</code>和<code>id_rsa.pub</code>两个文件，然后需要修改问年间权限<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>chmod <span class="number">775</span> ~<span class="regexp">/.ssh</span></div></pre></td></tr></table></figure></p>
<p>将<code>id_rsa.pub</code>上传到服务器的<code>~/.ssh/</code>文件夹下，其实也不用上传，直接把这个文件的内容复制然后在服务器的对应文件夹下创建文件，然后写入也是一样的。</p>
<ol>
<li>在<code>~/.ssh/</code>文件夹里创建配置文件<code>config</code><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Host my_server <span class="comment">// 服务器别名</span></div><div class="line">    HostName <span class="number">192.168</span><span class="number">.1</span><span class="number">.120</span>  <span class="comment">// 服务器ip</span></div><div class="line">    User root   <span class="comment">//登录用户名</span></div><div class="line">    Port <span class="number">22</span>     <span class="comment">// ssh端口</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="服务器机器配置"><a href="#服务器机器配置" class="headerlink" title="服务器机器配置"></a>服务器机器配置</h4><ol>
<li>修改<code>/etc/ssh/sshd_config</code>文件,将下面几行前面的注释去掉<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">RSAAuthentication</span> <span class="literal">yes</span></div><div class="line">PubkeyAuthentication <span class="literal">yes</span></div><div class="line">AuthorizedKeysFile      %h/.ssh/authorized_keys</div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果已经注释掉了就不用配置则这里了，</p>
<ol>
<li>在用户目录下创建<code>.ssh</code>文件夹，如果有就不用创建了，具体路径为<code>~/.ssh/</code><br>然后在<code>~/.ssh/</code>文件夹下面创建<code>authorized_keys</code>文件,并将之前上传到服务器上的<code>id_rsa.pub</code>文件里的内容拷贝到<code>authorized_keys</code>中,保存之后重启ssh服务</li>
</ol>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>cd ~<span class="regexp">/.ssh/</span></div><div class="line"><span class="variable">$ </span>sudo cat id_rsa.pub &gt; authorized_keys</div><div class="line"><span class="variable">$ </span>sudo chmod <span class="number">644</span> authorized_keys</div><div class="line"><span class="variable">$ </span>sudo service sshd restart</div></pre></td></tr></table></figure>
<h4 id="本机测试"><a href="#本机测试" class="headerlink" title="本机测试"></a>本机测试</h4><p>通过终端连接服务器<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>ssh my_server</div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong>如果这一步出现<code>bad owers</code>等错误，记得要修改本机的文件权限<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">$</span> chmod <span class="number">700</span> ~/.ssh</div><div class="line"><span class="symbol">$</span> chmod go+rwx ~/.ssh<span class="comment">/*</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux使用/">Linux使用</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/23/脚本语言时间处理函数总结/" title="脚本语言时间处理函数总结" itemprop="url">脚本语言时间处理函数总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-23T05:55:58.000Z" itemprop="datePublished"> 发表于 2016-04-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>平时做数据分析统计跑程序脚本需呀经常用到各种时间的转化和传入，日期的格式化，日期的相减，字符串时间互转。每次都是现查，比较浪费时间，这里把平时常用到的总结一下，因为涉及到好几个脚本语言的时间函数，我也记不住，干脆整理出一个查表更方便。主要涉及到Shell,Python,MySQL,Hive这几个脚本</p>
<h3 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h3><p>Shell感觉是最生涩的，最恶心的就是空格不能多也不能少，也没个IDE命令提示啥的，用的也最少，所以老容易忘</p>
<ul>
<li>常用的几种用法</li>
</ul>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">date</span>	以默认格式显示当前日期(Fri Nov <span class="number">18</span> <span class="number">10</span>:<span class="number">38</span>:<span class="number">07</span> CST <span class="number">2011</span>)</div><div class="line">$ <span class="keyword">date</span> +%Y%m%d             以yyyymmdd格式输出(<span class="number">20160423</span>)</div><div class="line">$ <span class="keyword">date</span> +<span class="string">"%Y%m%d %A"</span>		以<span class="string">"yyyymmdd 星期"</span>格式输出(<span class="number">20160423</span> Friday)  </div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"1 day"</span> +%Y%m%d	显示一天后的日期(<span class="number">20160424</span>)</div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"3 day ago"</span> +%Y-%m-%d	以指定格式显示<span class="number">3</span>天前的日期(<span class="number">2016</span><span class="number">-04</span><span class="number">-26</span>)</div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"1 month"</span> +%Y-%m-%d	以指定格式显示一个月后的日期</div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"1 month"</span> +%s	以指定格式显示一个月后的日期的秒数，%S为当前的秒数(<span class="number">0</span>～<span class="number">59</span>)</div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"1970-01-01 CST 1 second"</span> +%s	显示从<span class="number">1970</span><span class="number">-01</span><span class="number">-01</span> CST起<span class="number">1</span>秒后的秒数</div></pre></td></tr></table></figure>
<ul>
<li>用<code>-d</code>这个参数可以产生各种时间组合</li>
</ul>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">date</span> -d <span class="string">"-2 day 20160423"</span> +%Y%m%d</div><div class="line"><span class="number">20160421</span></div><div class="line">$ <span class="keyword">date</span> -d <span class="string">"+7 day 20160423"</span> +%Y%m%d</div><div class="line"><span class="number">20160430</span></div></pre></td></tr></table></figure>
<ul>
<li>日期循环</li>
</ul>
<p>这个场景还是很常用的，一般脚本都是默认跑当天或者前一天的数据，如果要一次重跑每一天的数据，可能就需要用到Shell日期循环：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">begin_date=<span class="string">'20160401'</span></div><div class="line">end_date=<span class="string">'20160423'</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> [ <span class="string">"<span class="variable">$begin_date</span>"</span> != <span class="string">"<span class="variable">$end_date</span>"</span> ]</div><div class="line"><span class="keyword">do</span></div><div class="line">	<span class="built_in">echo</span> <span class="variable">$begin_date</span></div><div class="line">	begin_date=`date <span class="_">-d</span> <span class="string">"1 day <span class="variable">$begin_date</span>"</span> +%Y%m%d`</div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure></p>
<p><strong>注意:</strong>一定要用<code>&quot;&quot;</code>把条件扩起来，<code>!=</code>史比较字符串的。</p>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>Python里用的比较多的就是两个包<code>datetime</code>,<code>time</code></p>
<ul>
<li>datetime</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">datetime.datetime.now().strftime(<span class="string">'%Y-%m-%d'</span>)	<span class="comment"># 2016-04-23</span></div><div class="line">str(datetime.datetime.now())[:<span class="number">10</span>]	<span class="comment"># 2016-04-23</span></div><div class="line">(datetime.datetime.now() + datetime.timedelta(days=<span class="number">-1</span>)).strftime(<span class="string">'%Y-%m-%d'</span>)	<span class="comment"># 2016-04-22</span></div><div class="line">datetime.datetime.strptime(<span class="string">'2016-04-23'</span>, <span class="string">'%Y-%m-%d'</span>)	<span class="comment"># 将字符串格式为datetime对象</span></div><div class="line">(d1 - d2 ).days	<span class="comment"># d1,d2 为datetime对象，计算连个日期之间相差多少天</span></div><div class="line">(d1 - d2 ).seconds	<span class="comment"># d1,d2 为datetime对象，计算连个日期之间相差多少秒</span></div><div class="line">datetime.weekday()	<span class="comment"># 返回weekday，如果是星期一，返回0；如果是星期2，返回1，以此类推；</span></div><div class="line">datatime.isoweekday()	<span class="comment"># 返回weekday，如果是星期一，返回1；如果是星期2，返回2，以此类推；</span></div><div class="line">datetime.fromtimestamp(timestamp)	<span class="comment"># 根据给定的时间戮，返回一个datetime对象；</span></div></pre></td></tr></table></figure>
<ul>
<li>time<figure class="highlight cos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">time.strftime('<span class="built_in">%Y</span>-<span class="built_in">%m</span>-<span class="built_in">%d</span> <span class="built_in">%H</span>:<span class="built_in">%M</span>:<span class="built_in">%S</span>') # 格式化输出当前时间</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p>主要是一些时间转换函数<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="section">mysql&gt; select unix_timestamp('2016-01-01 10:10:10');</span></div><div class="line">+---------------------------------------+</div><div class="line"><span class="section">| unix_timestamp('2016-01-01 10:10:10') |</span></div><div class="line">+---------------------------------------+</div><div class="line"><span class="section">|                            1451614210 |</span></div><div class="line">+---------------------------------------+</div><div class="line">1 row in set (0.01 sec)</div><div class="line"></div><div class="line"><span class="section">mysql&gt; select from_unixtime(unix_timestamp());</span></div><div class="line">+---------------------------------+</div><div class="line"><span class="section">| from_unixtime(unix_timestamp()) |</span></div><div class="line">+---------------------------------+</div><div class="line"><span class="section">| 2016-06-18 13:07:53             |</span></div><div class="line">+---------------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<h3 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">to_date('2016<span class="string">-04</span><span class="string">-23</span>')	# 2016<span class="string">-04</span><span class="string">-23</span></div><div class="line">to_date('2016<span class="string">-04</span><span class="string">-23</span> 12:21:10')	# 2016<span class="string">-04</span><span class="string">-23</span></div><div class="line">datediff(end_time, start_time)	# 返回日期相隔天数</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Shell/">Shell</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Python/">Python</a><a href="/tags/Hive/">Hive</a><a href="/tags/Shell/">Shell</a><a href="/tags/MySQL/">MySQL</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/23/Ubuntu-your-firefox-profile-cannot-be-loaded/" title="Ubuntu your firefox profile cannot be loaded" itemprop="url">Ubuntu your firefox profile cannot be loaded</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-23T05:43:51.000Z" itemprop="datePublished"> 发表于 2016-04-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>一时手贱把<code>~/tmp/</code>文件夹删了，结果火狐打不开了,最后在网上找了很久才找到解决方案，记录一下防止下次手贱了。<br>大部分文章只提到，把<code>~/.mozilla</code>文件的权限更改成当前用户和用户组，就可以了：</p>
<ul>
<li>察看.mozilla文件件的权限属性</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls <span class="_">-l</span></div></pre></td></tr></table></figure>
<p>如果<code>~/.mozilla</code>文件夹的属性是<code>root</code>则改变文件夹的属性为当前用户。命令如下：</p>
<ul>
<li>需改文件夹权限</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo chown -hR <span class="symbol">zhangsan:</span>zhangsan ~<span class="regexp">/.mozilla/</span></div></pre></td></tr></table></figure>
<p>如此操作后，其实firefox还是启动不了，因为，还有一个文件夹的属性仍然是root，这个文件夹就是<code>~/.cache/mozilla</code>。<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">$</span> cd ~/.cache</div><div class="line"><span class="symbol">$</span> ls -l </div><div class="line"><span class="symbol">$</span> sudo chown -hR zhangsan:zhangsan mozilla/</div></pre></td></tr></table></figure></p>
<p>经过如此折腾，双击firefox图标，才能正常启动firefox浏览器。<br>太坑爹了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux使用/">Linux使用</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/23/MySQL过滤中文/" title="MySQL过滤中文" itemprop="url">MySQL过滤中文</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-23T05:36:48.000Z" itemprop="datePublished"> 发表于 2016-04-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>有时候在统计的时候，需要把包含中文的列过滤掉，主要是存在历史脏数据，比如我们的客户端存在新老客户端之分，日志记录不一样，所有有些活动或者名字在pv,uv的时候不一致，例如活动的名字一般就算有英文也不可能全是英文，所以我们在计算的时候，需要把全为英文的过滤掉:<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">where</span> LENGTH(`col_name`) &lt;&gt; CHARACTER_LENGTH(`col_name`)</div></pre></td></tr></table></figure></p>
<p>这里的<code>col_name</code>是mysql里表的列名</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/SQL/">SQL</a><a href="/tags/Shell/">Shell</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/23/MySQL-创建用户以及附权限/" title="MySQL 创建用户以及附权限" itemprop="url">MySQL 创建用户以及附权限</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-04-23T04:50:52.000Z" itemprop="datePublished"> 发表于 2016-04-23</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>有时候为了测试，需要单独建一些MySQL用户来限定这部分用户的权限，并且需要限定哪些ip可以访问到我的数据库，具体步骤为,在装有MysQL的机器上执行：</p>
<ol>
<li>创建用户，一般为了避免暴露自己的密码习惯，可以用Linux自带的生成密码命令</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">➜✗ md5pass</div><div class="line">$1$6Fy9BTnB$Ruw50OR1oiUCwP73abnlD0</div></pre></td></tr></table></figure>
<p><strong>备注:</strong><code>6Fy9BTnB</code>为用户名，<code>Ruw50OR1oiUCwP73abnlD0</code>为密码<br>然后执行MySQL命令，语法为:<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="keyword">CREATE</span> USER <span class="string">'username'</span>@<span class="string">'host'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'password'</span>;</div></pre></td></tr></table></figure></p>
<p>假设你机器IP为<code>192.168.1.101</code>,则对应的命令为:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'6Fy9BTnB'</span>@<span class="string">'Ruw50OR1oiUCwP73abnlD0'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'192.168.1.101'</span>;</div></pre></td></tr></table></figure></p>
<ol>
<li>给MySQL用户附权限</li>
</ol>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; grant 权限<span class="number">1</span>,权限<span class="number">2</span>,<span class="params">...</span>权限n <span class="keyword">on</span> 数据库名称.表名称 <span class="keyword">to</span> 用户名@用户地址 identified <span class="keyword">by</span> <span class="string">'password'</span>;</div></pre></td></tr></table></figure>
<p>例如:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">mysql</span>&gt;<span class="selector-tag">grant</span> <span class="selector-tag">select</span>,<span class="selector-tag">insert</span>,<span class="selector-tag">update</span>,<span class="selector-tag">delete</span>,<span class="selector-tag">create</span>,<span class="selector-tag">drop</span> <span class="selector-tag">on</span> <span class="selector-tag">order</span><span class="selector-class">.oerder_info</span> <span class="selector-tag">to</span> 6<span class="selector-tag">Fy9BTnB</span>@<span class="keyword">192</span>.<span class="keyword">168</span>.<span class="keyword">1</span>.<span class="keyword">101</span> identified by <span class="string">'Ruw50OR1oiUCwP73abnlD0'</span>;</div></pre></td></tr></table></figure></p>
<p>只有来自192.168.1.101的用户6Fy9BTnB才能有对应的访问权限，其他的机器是无法访问的。<br>这里还有个快捷的操作，如果要附所有表的的所有操作权限，不可能一个一个去写，命令如下:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">mysql</span>&gt;<span class="selector-tag">grant</span> <span class="selector-tag">all</span> <span class="selector-tag">privileges</span> <span class="selector-tag">on</span> <span class="selector-tag">order</span><span class="selector-class">.oerder_info</span> <span class="selector-tag">to</span> 6<span class="selector-tag">Fy9BTnB</span>@<span class="keyword">192</span>.<span class="keyword">168</span>.<span class="keyword">1</span>.<span class="keyword">101</span> identified by <span class="string">'Ruw50OR1oiUCwP73abnlD0'</span>;</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/SQL/">SQL</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/25/CentOS-pip-无法安装python包/" title="CentOS pip 无法安装python包" itemprop="url">CentOS pip 无法安装python包</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-02-25T12:56:44.000Z" itemprop="datePublished"> 发表于 2016-02-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>最初源于一个错误，在使用python包<code>sqlalchemy</code>执行sql统计的时候，报错：</p>
<blockquote>
<p>This result object is closed sqlalchemy</p>
</blockquote>
<p>网上查阅了一下，貌似是多个线程共同使用一个会话或者连接导致，由于之前在其他机器上使用的1.0.8版本同样的sql都没有报过错，我直接用yum安装的0.7.x版本，可能是这个版本比较老，于是我想重新使用pip安装最新版，由于之前升级python，pip是我编译安装的最新版，CentOS自带的是1.4.x版本，我安装的是7.1.2，所以才会有下面的各种问题。<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip <span class="keyword">install</span> sqlalchemy</div></pre></td></tr></table></figure></p>
<p>报错：</p>
<blockquote>
<p>Requirement already satisfied (use –upgrade to upgrade): sqlalchemy in /home/q/python27/lib/python2.7/site-packages<br>You are using pip version 7.1.2, however version 8.0.2 is available.<br>You should consider upgrading via the ‘pip install –upgrade pip’ command.</p>
</blockquote>
<p>于是加上建议重新安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip install --upgrade sqlalchemy</div></pre></td></tr></table></figure></p>
<p>仍然报错：</p>
<blockquote>
<p>The repository located at pypi.corp.qunar.com is not a trusted or secure host and is being ignored. If this repository is available via HTTPS it is recommended to use HTTPS instead, otherwise you may silence this warning and allow it anyways with ‘–trusted-host pypi.abc.def.com’.</p>
</blockquote>
<p>依然按照建议加上参数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip install --trusted-host pypi.abc.def.com --upgrade sqlalchemy</div></pre></td></tr></table></figure></p>
<p>然后就安装成功了。</p>
<p>有时候升级pip会报这个错:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The pip==<span class="number">7.1</span><span class="number">.0</span>' distribution was <span class="keyword">not</span> found <span class="keyword">and</span> <span class="keyword">is</span> required <span class="keyword">by</span> <span class="keyword">the</span> <span class="built_in">application</span></div></pre></td></tr></table></figure></p>
<p>详细解决方案如下:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@xxx ~]<span class="comment"># easy_install pip</span></div><div class="line">Searching <span class="keyword">for</span> pip</div><div class="line">Best match: pip <span class="number">9.0</span><span class="number">.1</span></div><div class="line">Adding pip <span class="number">9.0</span><span class="number">.1</span> <span class="keyword">to</span> easy-install.pth <span class="built_in">file</span></div><div class="line">Installing pip <span class="keyword">script</span> <span class="keyword">to</span> /usr/<span class="keyword">local</span>/python2<span class="number">.7</span>/bin</div><div class="line">Installing pip3<span class="number">.5</span> <span class="keyword">script</span> <span class="keyword">to</span> /usr/<span class="keyword">local</span>/python2<span class="number">.7</span>/bin</div><div class="line">Installing pip3 <span class="keyword">script</span> <span class="keyword">to</span> /usr/<span class="keyword">local</span>/python2<span class="number">.7</span>/bin</div><div class="line"></div><div class="line">Using /usr/<span class="keyword">local</span>/python2<span class="number">.7</span>/lib/python2<span class="number">.7</span>/site-packages</div><div class="line">Processing dependencies <span class="keyword">for</span> pip</div><div class="line">Finished processing dependencies <span class="keyword">for</span> pip</div></pre></td></tr></table></figure></p>
<p>然后看看系统的pip是哪个地方:<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root<span class="symbol">@xxx</span> ~]<span class="meta"># which pip</span></div><div class="line">/usr/bin/pip</div></pre></td></tr></table></figure></p>
<p>然后我们需要编辑一下这个文件<code>vi /usr/bin/pip</code>:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># EASY-INSTALL-ENTRY-SCRIPT: 'pip==7.1.0','console_scripts','pip'</span></div><div class="line">__requires__ = <span class="string">'pip==9.0.1'</span></div><div class="line">import sys</div><div class="line">from pkg_resources import load_entry_point</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    sys.<span class="keyword">exit</span>(</div><div class="line">        load_entry_point(<span class="string">'pip==9.0.1'</span>, <span class="string">'console_scripts'</span>, <span class="string">'pip'</span>)()</div><div class="line">    )</div></pre></td></tr></table></figure></p>
<p>就是把pip改成你系统安装的pip,然后就可以安装包了．</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python笔记/">Python笔记</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/Python/">Python</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/02/25/matplotlib-中文乱码/" title="matplotlib 中文乱码" itemprop="url">matplotlib 中文乱码</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="LittleQ" target="_blank" itemprop="author">LittleQ</a>
		
  <p class="article-time">
    <time datetime="2016-02-25T12:37:40.000Z" itemprop="datePublished"> 发表于 2016-02-25</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在使用matplotlib画图的时候，出现了以下错误：</p>
<blockquote>
<p>/home/q/python27/lib/python2.7/site-packages/matplotlib-1.5.1-py2.7-linux-x86_64.egg/matplotlib/font_manager.py:1288: UserWarning: findfont: Font family [u’sans-serif’] not found. Falling back to Bitstream Vera Sans<br>  (prop.get_family(), self.defaultFamily[fontext]))</p>
</blockquote>
<p>这让我十分费解，应该有这个字体的，于是让其他人登陆跑同样的程序则可以运行，于是我好奇登陆了交互式环境，引入<code>matplotlib</code>包看了一下，结果出现以下错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Python 2.7.4 (default, Dec 24 2013, 16:30:42)</div><div class="line">[GCC 4.4.6 20110731 (Red Hat 4.4.6-3)] on linux2</div><div class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</div><div class="line">&gt;&gt;&gt; import matplotlib</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/matplotlib-1.5.1-py2.7-linux-x86_64.egg/matplotlib/__init__.py"</span>, line 111, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    import inspect</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/inspect.py"</span>, line 42, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from collections import namedtuple</div><div class="line">  File <span class="string">"collections.py"</span>, line 17, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    import numpy as np</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/__init__.py"</span>, line 180, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from . import add_newdocs</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/add_newdocs.py"</span>, line 13, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from numpy.lib import add_newdoc</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/lib/__init__.py"</span>, line 8, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from .type_check import *</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/lib/type_check.py"</span>, line 11, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    import numpy.core.numeric as _nx</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/core/__init__.py"</span>, line 58, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from numpy.testing import Tester</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/site-packages/numpy-1.10.4-py2.7-linux-x86_64.egg/numpy/testing/__init__.py"</span>, line 10, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from unittest import TestCase</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/unittest/__init__.py"</span>, line 58, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    from .result import TestResult</div><div class="line">  File <span class="string">"/home/q/python27/lib/python2.7/unittest/result.py"</span>, line 9, <span class="keyword">in</span> &lt;module&gt;</div></pre></td></tr></table></figure></p>
<p>这个时候就很郁闷了，服务器上的<code>matplotlib</code>都是我装的，结果反倒我不能用，但是后来在网上看到了解决方案:原来出现这个问题是由于用户目录下的缓存导致的，需要清空缓存:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo rm -r ~/.cache/</div></pre></td></tr></table></figure></p>
<p>清空缓存之后就可以运行了。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Python笔记/">Python笔记</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/Python/">Python</a><a href="/tags/matplotlib/">matplotlib</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/6/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Django/" title="Django">Django<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Flask/" title="Flask">Flask<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Hive笔记/" title="Hive笔记">Hive笔记<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/JScript/" title="JScript">JScript<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java笔记/" title="Java笔记">Java笔记<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux使用/" title="Linux使用">Linux使用<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/MySQL/" title="MySQL">MySQL<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python笔记/" title="Python笔记">Python笔记<sup>25</sup></a></li>
		  
		
		  
			<li><a href="/categories/Shell/" title="Shell">Shell<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Vim/" title="Vim">Vim<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/博客搭建/" title="博客搭建">博客搭建<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/开发环境/" title="开发环境">开发环境<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据挖掘/" title="数据挖掘">数据挖掘<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂七杂八/" title="杂七杂八">杂七杂八<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>64</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>42</sup></a></li>
			
		
			
				<li><a href="/tags/开发工具/" title="开发工具">开发工具<sup>19</sup></a></li>
			
		
			
				<li><a href="/tags/Web/" title="Web">Web<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/SQL/" title="SQL">SQL<sup>14</sup></a></li>
			
		
			
				<li><a href="/tags/Hive/" title="Hive">Hive<sup>13</sup></a></li>
			
		
			
				<li><a href="/tags/Shell/" title="Shell">Shell<sup>12</sup></a></li>
			
		
			
				<li><a href="/tags/开发环境/" title="开发环境">开发环境<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Vim/" title="Vim">Vim<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/大数据/" title="大数据">大数据<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Flask/" title="Flask">Flask<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/IDEA/" title="IDEA">IDEA<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Js/" title="Js">Js<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/JS/" title="JS">JS<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/可视化/" title="可视化">可视化<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Sublime-Text/" title="Sublime Text">Sublime Text<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="LittleQ">LittleQ</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
